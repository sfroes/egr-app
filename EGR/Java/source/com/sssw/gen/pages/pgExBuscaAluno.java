// *** Generated Source File ***
// Portions Copyright (c) 1996-2001, SilverStream Software, Inc., All Rights Reserved

package com.sssw.gen.pages; // generated by SilverStream: do not edit

import java.awt.*;
import java.util.*;
import java.math.*;
import com.sssw.rt.gui.*;
import com.sssw.rt.util.*;
import com.sssw.rt.event.*;
import java.awt.event.*;
import com.sssw.rt.expr.*;
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import com.sssw.shr.page.*;
import com.sssw.shr.http.AgiHttpServletRequest;
import com.sssw.shr.http.AgiHttpServletResponse;
import com.sssw.shr.http.AgoServletException;
import com.sssw.srv.api.*;
import com.sssw.srv.busobj.*;
import com.sssw.srv.mail.*;

public class pgExBuscaAluno extends AgpPage // generated by SilverStream: do not edit
{
	String SISTEMA = "";
	String PAGINA = "";

	public com.sssw.shr.page.AgpTextField	evento;
	public com.sssw.shr.page.AgpTable	tblCurso;
	public com.sssw.shr.page.AgpChoice	chCurso;
	public com.sssw.shr.page.AgpData	agpAluno;
	public com.sssw.shr.page.AgpButtonText	btnBuscar;
	public com.sssw.shr.page.AgpChoice	chOrigem;
	public com.sssw.shr.page.AgpTextField	fldNome;
	public com.sssw.shr.page.AgpTextField	fldDataNascimento;
	
public pgExBuscaAluno()
	{
		//==== Warning: SilverStream-generated method: do not edit. All changes will be lost ===
	}

	public void init() throws Exception
	{
		//==== Warning: SilverStream-generated method: do not edit. All changes will be lost ===
		agData.setDataMode(AgoData.DATA_MODE_NORMAL);
		// Initialize fldDataNascimento
			fldDataNascimento = (com.sssw.shr.page.AgpTextField) getControl("fldDataNascimento");
			fldDataNascimento.setDatatype(DatatypeCodes.TYPE_STRING);
		// Initialize fldNome
			fldNome = (com.sssw.shr.page.AgpTextField) getControl("fldNome");
			fldNome.setDatatype(DatatypeCodes.TYPE_STRING);
		// Initialize chOrigem
			chOrigem = (com.sssw.shr.page.AgpChoice) getControl("chOrigem");
			chOrigem.setDisplayExpression(0);
			chOrigem.setValueExpression(1);
			chOrigem.setAutomaticQuery(true);
		// Initialize tblCurso
			tblCurso = (com.sssw.shr.page.AgpTable) getControl("tblCurso");
		// Initialize chCurso
			chCurso = (com.sssw.shr.page.AgpChoice) getControl("chCurso");
			chCurso.setDisplayExpression(2);
			chCurso.setValueExpression(3);
		// Initialize evento
			evento = (com.sssw.shr.page.AgpTextField) getControl("evento");
			evento.setDatatype(DatatypeCodes.TYPE_STRING);
		// Initialize agpAluno
			agpAluno = (com.sssw.shr.page.AgpData) getControl("agpAluno");
			agpAluno.setName("agpAluno");
			agpAluno.setExpressionCount(7);
			agpAluno.setExpression(0, 4, "seq_aluno", 0);
			agpAluno.setExpression(1, 5, "cod_aluno", 1);
			agpAluno.setExpression(2, 6, "cod_pessoa", 2);
			agpAluno.setExpression(3, 7, "seq_origem", 3);
			agpAluno.setExpression(4, 8, "seq_curso", 4);
			agpAluno.setExpression(5, 9, "dat_nascimento", 5);
			agpAluno.setExpression(6, 10, "nom_aluno", 6);
		// Initialize btnBuscar
			btnBuscar = (com.sssw.shr.page.AgpButtonText) getControl("btnBuscar");

		addChildren();

		addBindings();

		return;
	}

	private void addChildren()
	{
		//==== Warning: SilverStream-generated method: do not edit. All changes will be lost ===
	}

	protected void addBindings()
	{
		//==== Warning: SilverStream-generated method: do not edit. All changes will be lost ===
		addExpDependencies();
	}

	protected void pageRequestEnd(AgiHttpServletRequest req, AgiHttpServletResponse res) throws Exception
	{
		// Configura o controle de cache
		Hashtable hs = new Hashtable();		
		hs.put("response", res);
		invokeBusinessObject("Util:boCacheConfig", hs);
	}

	




















protected void pageLoaded(AgiHttpServletRequest req, AgiHttpServletResponse res) throws Exception
	{
		SISTEMA = getDatabase() + " - ";	
		PAGINA = getPath().substring(getPath().lastIndexOf('/') + 1, getPath().lastIndexOf('.'));

		// Aplica o estilo
		fldNome.setProperty("CLASS", "texto");
		fldDataNascimento.setProperty("CLASS", "texto");
		btnBuscar.setProperty("CLASS", "botao");
	
		// Altera o evento onChange do combo de origem
		chOrigem.setProperty("onChange", "selCurso()");
	}

	public Object ag_getValue(DataCursor cursor, int valueID, Object param1, Object param2)
	{
		//==== Warning: SilverStream-generated method: do not edit. All changes will be lost ===
		try
		{
			switch (valueID)
			{
				case 0:
					/* chOrigem () origem.nom_origem*/
					return ((String) cursor.getProperty(0));

				case 1:
					/* chOrigem () origem.seq_origem*/
					return ((Integer) cursor.getProperty(1));

				case 2:
					/* chCurso () curso.nom_curso*/
					return ((String) cursor.getProperty(0));

				case 3:
					/* chCurso () curso.seq_curso*/
					return ((Integer) cursor.getProperty(1));

				case 4:
					/* seq_aluno () vw_ss_busca_aluno.seq_aluno*/
					return ((Integer) cursor.getProperty(0));

				case 5:
					/* cod_aluno () vw_ss_busca_aluno.cod_aluno*/
					return ((Integer) cursor.getProperty(1));

				case 6:
					/* cod_pessoa () vw_ss_busca_aluno.cod_pessoa*/
					return ((Integer) cursor.getProperty(2));

				case 7:
					/* seq_origem () vw_ss_busca_aluno.seq_origem*/
					return ((Integer) cursor.getProperty(3));

				case 8:
					/* seq_curso () vw_ss_busca_aluno.seq_curso*/
					return ((Integer) cursor.getProperty(4));

				case 9:
					/* dat_nascimento () vw_ss_busca_aluno.dat_nascimento*/
					return ((String) cursor.getProperty(5));

				case 10:
					/* nom_aluno () vw_ss_busca_aluno.nom_aluno*/
					return ((String) cursor.getProperty(6));

				default:
					return null;
			}
		}
		catch (Throwable e)
		{
			return null;
		}
	}

	





protected void pageGenerateBegin() throws Exception
	{
		final String METODO = ".pageGenerateBegin()";
	
		try {
			if (evento.getText().equals("")) {
				// Remove todas as variáveis de sessão que existirem
				Hashtable ht = new Hashtable();
				ht.put("pSessao", (AgiSession)getCurrentRequest().getSession());
				invokeBusinessObject("Util:boLimpaVarSessao", ht);

				// Limpa os campos
				fldNome.setText("");
				if (!chOrigem.getItem(0).equals(""))
					chOrigem.insert("", 0);
				chOrigem.select(0);
				fldDataNascimento.setText("");
				
				// Esconde a table de curso
				tblCurso.setEnableHTMLGeneration(false);

				// Foco no nome do aluno
				writeScript("Page.fldNome.focus();");
			}
			
			else if (evento.getText().equals("selCurso"))
				evtSelCurso();
				
			else if (evento.getText().equals("buscarAluno"))
				evtBuscarAluno();
		
			// Limpa o evento
			evento.setText("");
		}
		catch (Exception e){
			Hashtable hs = new Hashtable();
			hs.put("pIdentificador", SISTEMA + PAGINA + METODO);
			hs.put("pException", e);
			invokeBusinessObject("Util:boEnviaMsgConsole", hs);
		}
	}

	




public void evtSelCurso()
		throws Exception
	{
		final String METODO = ".evtSelCurso()";

		try {
			// Se não selecionou a linha em branco.
			if(chOrigem.getSelectedIndex() != 0) {
				// Filtra a combo de curso de acordo com a origem selecionada
				chCurso.query("curso.seq_origem = " + (Integer)chOrigem.getItemValue(chOrigem.getSelectedIndex()));
				if (chCurso.getItemCount() > 0) {
					if (!chCurso.getItem(0).equals(""))
						chCurso.insert("", 0);
					chCurso.select(0);
				}
				
				// Mostra a tabela de curso
				tblCurso.setEnableHTMLGeneration(true);
			} 
			else {
				// Esconde a tabela de curso
				tblCurso.setEnableHTMLGeneration(false);
			}

			// Foco no curso
			writeScript("Page.chCurso.focus();");
		}
		catch(Exception e) {
			Hashtable hs = new Hashtable();
			hs.put("pIdentificador", SISTEMA + PAGINA + METODO);
			hs.put("pException", e);
			invokeBusinessObject("Util:boEnviaMsgConsole", hs);
		}
	}

	







public void evtBuscarAluno()
		throws Exception
	{
		final String METODO = ".evtBuscarAluno()";

		try {
			/* NA BUSCA DO ALUNO ESTAMOS CONSIDERANDO O Ç = C */
			String nome = fldNome.getText();
			nome = nome.replace('ç', 'c');
		

			// Busca o aluno
			agpAluno.query(	"vw_ss_busca_aluno.nom_aluno = '" + nome +
							"' and vw_ss_busca_aluno.seq_curso = " + (Integer)chCurso.getItemValue(chCurso.getSelectedIndex()) +
							" and vw_ss_busca_aluno.dat_nascimento = '" + fldDataNascimento.getText() + "'");


			if (agpAluno.gotoFirst()) {
				// Achou o aluno, seta variável de sessão vsSeqAluno
				setSessionValue("vsSeqAluno", (Integer)agpAluno.getProperty("seq_aluno"));
			}
			else {
				// Não achou o aluno, seta as variáveis de sessão 
				setSessionValue("vsSeqAluno", new Integer(0));
				setSessionValue("vsNome", fldNome.getText());
				setSessionValue("vsSeqOrigem", (Integer)chOrigem.getItemValue(chOrigem.getSelectedIndex()));
				setSessionValue("vsSeqCurso", (Integer)chCurso.getItemValue(chCurso.getSelectedIndex()));
				setSessionValue("vsDatNascimento", fldDataNascimento.getText());
			}

//			showPage("pgExCadastroAluno.html");
			agScriptHelper.openWindow("fsExAluno2.html", "_top", "");

		}
		catch(Exception e) {
			Hashtable hs = new Hashtable();
			hs.put("pIdentificador", SISTEMA + PAGINA + METODO);
			hs.put("pException", e);
			invokeBusinessObject("Util:boEnviaMsgConsole", hs);
		}
	}

	protected void pageRequestBegin(AgiHttpServletRequest req, AgiHttpServletResponse res) throws Exception
	{
		req.getSession().setMaxInactiveInterval(-1);
	}
}
